# =============================================================================
# Production Environment Inventory
# =============================================================================
# Voice of Customer Platform - Production Infrastructure
#
# This inventory defines all hosts for the production environment.
# Sensitive values should be stored in Vault and referenced via group_vars.
# =============================================================================

all:
  vars:
    # Global settings
    ansible_user: ansible
    ansible_become: true
    ansible_python_interpreter: /usr/bin/python3
    
    # Environment
    environment: production
    region: dc1
    domain: voicecustomer.io
    internal_domain: internal.voicecustomer.local
    
    # NTP servers
    ntp_servers:
      - 10.4.0.12
      - 10.4.0.13
    
    # DNS servers
    dns_servers:
      - 10.4.0.10
      - 10.4.0.11
    
    # Timezone
    timezone: UTC

  children:
    # =========================================================================
    # Kubernetes Cluster
    # =========================================================================
    kubernetes:
      children:
        k8s_masters:
          hosts:
            k8s-master-prd-dc1-01:
              ansible_host: 10.2.0.10
              etcd_member_name: etcd-01
            k8s-master-prd-dc1-02:
              ansible_host: 10.2.0.11
              etcd_member_name: etcd-02
            k8s-master-prd-dc1-03:
              ansible_host: 10.2.0.12
              etcd_member_name: etcd-03
          vars:
            node_role: master
            
        k8s_workers:
          children:
            k8s_workers_general:
              hosts:
                k8s-worker-prd-dc1-01:
                  ansible_host: 10.2.0.20
                k8s-worker-prd-dc1-02:
                  ansible_host: 10.2.0.21
                k8s-worker-prd-dc1-03:
                  ansible_host: 10.2.0.22
                k8s-worker-prd-dc1-04:
                  ansible_host: 10.2.0.23
                k8s-worker-prd-dc1-05:
                  ansible_host: 10.2.0.24
              vars:
                node_role: worker
                workload_type: general
                
            k8s_workers_ml:
              hosts:
                k8s-worker-ml-prd-dc1-01:
                  ansible_host: 10.2.0.30
                  gpu_enabled: true
                k8s-worker-ml-prd-dc1-02:
                  ansible_host: 10.2.0.31
                  gpu_enabled: true
              vars:
                node_role: worker
                workload_type: ml
                
        k8s_lb:
          hosts:
            k8s-lb-prd-dc1-01:
              ansible_host: 10.2.0.5
              keepalived_priority: 100
              keepalived_state: MASTER
            k8s-lb-prd-dc1-02:
              ansible_host: 10.2.0.6
              keepalived_priority: 99
              keepalived_state: BACKUP
          vars:
            haproxy_frontend_port: 6443
            keepalived_virtual_ip: 10.2.0.1
            
      vars:
        kubernetes_version: "1.29"
        pod_network_cidr: "10.244.0.0/16"
        service_cidr: "10.96.0.0/12"
        cluster_name: voicecustomer-prd

    # =========================================================================
    # VoIP Infrastructure (Bare Metal)
    # =========================================================================
    voip:
      children:
        asterisk:
          hosts:
            asterisk-voip-prd-dc1-01:
              ansible_host: 10.1.0.10
              asterisk_role: primary
            asterisk-voip-prd-dc1-02:
              ansible_host: 10.1.0.11
              asterisk_role: secondary
            asterisk-voip-prd-dc1-03:
              ansible_host: 10.1.0.12
              asterisk_role: conference
          vars:
            asterisk_version: "21"
            enable_webrtc: true
            enable_recording: true
            
        kamailio:
          hosts:
            kamailio-voip-prd-dc1-01:
              ansible_host: 10.1.0.20
              kamailio_role: primary
            kamailio-voip-prd-dc1-02:
              ansible_host: 10.1.0.21
              kamailio_role: backup
          vars:
            kamailio_version: "5.7"
            
        rtpengine:
          hosts:
            rtpengine-voip-prd-dc1-01:
              ansible_host: 10.1.0.30
            rtpengine-voip-prd-dc1-02:
              ansible_host: 10.1.0.31
          vars:
            rtpengine_min_port: 10000
            rtpengine_max_port: 20000
            
      vars:
        sip_domain: sip.voicecustomer.io
        rtp_start_port: 10000
        rtp_end_port: 20000

    # =========================================================================
    # Database Cluster
    # =========================================================================
    databases:
      children:
        postgresql:
          hosts:
            pg-data-prd-dc1-01:
              ansible_host: 10.3.0.10
              patroni_role: primary
            pg-data-prd-dc1-02:
              ansible_host: 10.3.0.11
              patroni_role: sync_replica
            pg-data-prd-dc1-03:
              ansible_host: 10.3.0.12
              patroni_role: async_replica
          vars:
            postgres_version: "16"
            patroni_scope: pg-prd-dc1
            postgres_data_dir: /var/lib/postgresql/data
            postgres_max_connections: 500
            
        pgbouncer:
          hosts:
            pg-pgbouncer-prd-dc1-01:
              ansible_host: 10.3.0.100
            pg-pgbouncer-prd-dc1-02:
              ansible_host: 10.3.0.101
          vars:
            pgbouncer_pool_mode: transaction
            pgbouncer_max_client_conn: 10000
            
        pg_haproxy:
          hosts:
            pg-haproxy-prd-dc1-01:
              ansible_host: 10.3.0.110
              keepalived_priority: 100
            pg-haproxy-prd-dc1-02:
              ansible_host: 10.3.0.111
              keepalived_priority: 99
          vars:
            pg_haproxy_virtual_ip: 10.3.0.100
            
        clickhouse:
          hosts:
            ch-analytics-prd-dc1-01:
              ansible_host: 10.3.0.20
              clickhouse_shard: 1
              clickhouse_replica: 1
            ch-analytics-prd-dc1-02:
              ansible_host: 10.3.0.21
              clickhouse_shard: 2
              clickhouse_replica: 1
            ch-analytics-prd-dc1-03:
              ansible_host: 10.3.0.22
              clickhouse_shard: 3
              clickhouse_replica: 1
          vars:
            clickhouse_version: "24.1"
            clickhouse_cluster_name: analytics
            
        redis:
          hosts:
            redis-cache-prd-dc1-01:
              ansible_host: 10.3.0.40
              redis_role: master
            redis-cache-prd-dc1-02:
              ansible_host: 10.3.0.41
              redis_role: replica
            redis-cache-prd-dc1-03:
              ansible_host: 10.3.0.42
              redis_role: replica
          vars:
            redis_version: "7"
            redis_maxmemory: 30gb
            redis_maxmemory_policy: allkeys-lru

    # =========================================================================
    # Message Queue
    # =========================================================================
    messaging:
      children:
        kafka:
          hosts:
            kafka-broker-prd-dc1-01:
              ansible_host: 10.3.0.50
              kafka_broker_id: 1
            kafka-broker-prd-dc1-02:
              ansible_host: 10.3.0.51
              kafka_broker_id: 2
            kafka-broker-prd-dc1-03:
              ansible_host: 10.3.0.52
              kafka_broker_id: 3
          vars:
            kafka_version: "3.6"
            kafka_heap_size: 6g
            kafka_num_partitions: 12
            kafka_replication_factor: 3
            
        zookeeper:
          hosts:
            kafka-zk-prd-dc1-01:
              ansible_host: 10.3.0.55
              zookeeper_id: 1
            kafka-zk-prd-dc1-02:
              ansible_host: 10.3.0.56
              zookeeper_id: 2
            kafka-zk-prd-dc1-03:
              ansible_host: 10.3.0.57
              zookeeper_id: 3
          vars:
            zookeeper_version: "3.9"

    # =========================================================================
    # Object Storage
    # =========================================================================
    storage:
      children:
        minio:
          hosts:
            minio-store-prd-dc1-01:
              ansible_host: 10.3.0.60
            minio-store-prd-dc1-02:
              ansible_host: 10.3.0.61
            minio-store-prd-dc1-03:
              ansible_host: 10.3.0.62
            minio-store-prd-dc1-04:
              ansible_host: 10.3.0.63
          vars:
            minio_erasure_set_size: 4
            minio_data_dir: /data/minio
            minio_buckets:
              - recordings
              - transcripts
              - events
              - logs
              - backups

    # =========================================================================
    # Management Infrastructure
    # =========================================================================
    management:
      children:
        bastion:
          hosts:
            bastion-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.5
          vars:
            bastion_allowed_users:
              - admin
              - devops
              
        monitoring:
          hosts:
            prometheus-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.20
            grafana-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.21
            loki-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.22
          vars:
            prometheus_retention: 30d
            
        vault:
          hosts:
            vault-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.30
            vault-mgmt-prd-dc1-02:
              ansible_host: 10.4.0.31
            vault-mgmt-prd-dc1-03:
              ansible_host: 10.4.0.32
          vars:
            vault_version: "1.15"
            vault_storage_backend: raft
            
        dns:
          hosts:
            dns-mgmt-prd-dc1-01:
              ansible_host: 10.4.0.10
            dns-mgmt-prd-dc1-02:
              ansible_host: 10.4.0.11
          vars:
            bind_version: "9"

    # =========================================================================
    # DMZ / Edge
    # =========================================================================
    dmz:
      children:
        loadbalancer:
          hosts:
            lb-edge-prd-dc1-01:
              ansible_host: 10.0.0.10
            lb-edge-prd-dc1-02:
              ansible_host: 10.0.0.11
          vars:
            haproxy_stats_port: 8404
            
        firewall:
          hosts:
            fw-edge-prd-dc1-01:
              ansible_host: 10.0.0.5
          vars:
            firewall_type: opnsense
