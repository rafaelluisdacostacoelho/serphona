Act as a senior engineer specialized in Stripe integrations.

I want you to design the Stripe integration layer (adapter) for the “Serphona Payments Service”.

Requirements:
- Use the official Stripe Go SDK.
- Implement a PaymentProvider interface dedicated to Stripe:
  - CreateOrUpdateCustomer(…)
  - CreateSubscription(…)
  - CancelSubscription(…)
  - CreatePaymentIntent(…) for wallet top-ups
  - RefundPayment(…)
  - RetrieveSubscriptionStatus(…)
- Use Stripe webhooks as the source of truth:
  - Handle events like invoice.paid, invoice.payment_failed, customer.subscription.created/updated/deleted, charge.succeeded, charge.refunded, payment_intent.succeeded, payment_intent.payment_failed.
- Ensure strong idempotency:
  - use Stripe idempotency keys for outgoing operations
  - store Stripe event IDs for incoming webhooks to avoid processing the same event twice.

Please:

1. Propose a StripeAdapter design in Go:
   - show a StripeAdapter struct and how it implements the PaymentProvider interface.
   - include configuration (API key, environment, webhook secrets, timeouts, retries).

2. Describe the webhook HTTP handler:
   - how to verify signatures
   - how to parse events in Go
   - how to route events to domain use cases (e.g., SubscriptionService.HandleStripeEvent).

3. Show a sample Go implementation sketch:
   - StripeAdapter interface implementation for at least: CreateSubscription and CreatePaymentIntent.
   - Webhook handler skeleton for processing events.

4. Explain how to ensure idempotency for:
   - outbound operations (create subscription, create payment intent)
   - inbound operations (webhooks), using a WebhookEventLog table with processed flags.

5. Suggest error-handling and retry strategies for transient Stripe errors versus permanent errors.

6. Highlight how to design this integration so that other PaymentProvider implementations (non-Stripe) can be plugged in later without breaking domain logic.
